# Running GraphQL queries in Next.js 13

1. Create a next app.

   ```
   npx create-next-app@latest
   ```

2. We are going to use graphql api created by space x. The said api is assessable at `https://main--spacex-l4uc6p.apollographos.net/graphql`

3. Install qraphql and apollo client in the app

   ```
   npm install graphql
   npm install @apollo/client
   ```

4. Create `src/lib/gqlProvider.tsx` to define apollo client and gql provider

   ```tsx
   "use client";
   import { ApolloClient, ApolloProvider, InMemoryCache } from "@apollo/client";
   const client = new ApolloClient({
     uri: "https://main--spacex-l4uc6p.apollographos.net/graphql",
     cache: new InMemoryCache(),
   });
   interface IGraphQlProviderProps {
     children: React.ReactNode;
   }
   const GraphQlProvider: React.FC<IGraphQlProviderProps> = ({ children }) => {
     return <ApolloProvider client={client}>{children}</ApolloProvider>;
   };
   export default GraphQlProvider;
   ```

5. Update `src/app/layout.tsx` to wrap the app with apollo provider

   ```tsx
   import "./globals.css";
   import type { Metadata } from "next";
   import { Inter } from "next/font/google";
   import GraphQLProvider from "../lib/gqlProvider";
   const inter = Inter({ subsets: ["latin"] });
   export const metadata: Metadata = {
     title: "Create Next App",
     description: "Generated by create next app",
   };

   export default function RootLayout({
     children,
   }: {
     children: React.ReactNode;
   }) {
     return (
       <html lang="en">
         <body className={inter.className}>
           <GraphQLProvider>{children}</GraphQLProvider>
         </body>
       </html>
     );
   }
   ```

6. Create `src/lib/gqlQueries.ts` to define query

   ```ts
   import { gql } from "@apollo/client";
   export const launchesQuery = gql`
     query Launches {
       launches {
         id
         details
         mission_name
         rocket {
           rocket_name
           rocket_type
         }
       }
     }
   `;
   ```

7. Create `src/components/Launches.tsx`

   ```tsx
   "use client";
   import { launchesQuery } from "@/lib/gqlQueries";
   import { useQuery } from "@apollo/client";
   import React from "react";
   export const Launches = () => {
     const { loading, error, data } = useQuery(launchesQuery);
     console.log(data);
     if (loading) return <p>Loading...</p>;
     if (error) return <p>Error :</p>;
     return (
       <ul>
         {data.launches.map((launch: any) => (
           <li key={launch.id}>{launch.mission_name}</li>
         ))}
       </ul>
     );
   };
   ```

8. Create `src/app/launches/page.tsx`

   ```tsx
   import { Launches } from "@/components/Launches";
   export default function LaunchesPage() {
     return (
       <div>
         <Launches />
       </div>
     );
   }
   ```

9. Run the app locally and visit the page at `http://localhost:3000/launches`
   ```
   npm run dev
   ```
